<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista formulario de contacto extendida -->
    <record id="view_partner_form_classification" model="ir.ui.view">
        <field name="name">res.partner.form.classification</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='category_id']" position="after">
                <field name="classification_ids"
                       widget="many2many_tags"
                       options="{'color_field': 'color'}"
                       placeholder="Seleccionar clasificaciones..."/>
            </xpath>
        </field>
    </record>

    <!-- Vista tree de contactos extendida -->
    <record id="view_partner_tree_classification" model="ir.ui.view">
        <field name="name">res.partner.tree.classification</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='display_name']" position="after">
                <field name="classification_display" string="Classifications"/>
            </xpath>
        </field>
    </record>

    <!-- Filtros en búsqueda -->
    <record id="view_res_partner_filter_classification" model="ir.ui.view">
        <field name="name">res.partner.filter.classification</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='salesperson']" position="after">
                <separator/>
                <filter name="filter_client" string="Clientes"
                        domain="[('is_client', '=', True)]"/>
                <filter name="filter_supplier" string="Proveedores"
                        domain="[('is_supplier', '=', True)]"/>
                <filter name="filter_director" string="Directores"
                        domain="[('is_director', '=', True)]"/>
                <filter name="filter_employee" string="Funcionarios"
                        domain="[('is_employee', '=', True)]"/>
                <filter name="filter_salesperson" string="Vendedores"
                        domain="[('is_salesperson', '=', True)]"/>
                <filter name="filter_carrier" string="Transportadoras"
                        domain="[('is_carrier', '=', True)]"/>
                <filter name="filter_bank" string="Bancos"
                        domain="[('is_bank', '=', True)]"/>
                <filter name="filter_other" string="Otros"
                        domain="[('is_other', '=', True)]"/>
            </xpath>

            <xpath expr="//group[@name='group_by']" position="inside">
                <separator/>
                <filter name="group_by_classification"
                        string="Clasificación"
                        context="{'group_by': 'classification_ids'}"/>
            </xpath>

            <xpath expr="//field[@name='name']" position="after">
                <field name="classification_ids"
                       filter_domain="[('classification_ids', 'ilike', self)]"/>
            </xpath>
        </field>
    </record>

    <!-- Vista de clasificaciones -->
    <record id="view_contact_classification_tree" model="ir.ui.view">
        <field name="name">contact.classification.tree</field>
        <field name="model">contact.classification</field>
        <field name="arch" type="xml">
            <tree string="Contact Classifications" editable="bottom">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="code"/>
                <field name="color" widget="color_picker"/>
                <field name="partner_count" string="Partners"/>
                <field name="active"/>
            </tree>
        </field>
    </record>

    <record id="view_contact_classification_form" model="ir.ui.view">
        <field name="name">contact.classification.form</field>
        <field name="model">contact.classification</field>
        <field name="arch" type="xml">
            <form string="Contact Classification">
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_partners"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-users">
                            <field name="partner_count" widget="statinfo"
                                   string="Partners"/>
                        </button>
                    </div>

                    <group>
                        <group>
                            <field name="name"/>
                            <field name="code"/>
                            <field name="sequence"/>
                        </group>
                        <group>
                            <field name="color" widget="color_picker"/>
                            <field name="active"/>
                        </group>
                    </group>

                    <group string="Description">
                        <field name="description" nolabel="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Kanban view -->
    <record id="view_contact_classification_kanban" model="ir.ui.view">
        <field name="name">contact.classification.kanban</field>
        <field name="model">contact.classification</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="name"/>
                <field name="code"/>
                <field name="color"/>
                <field name="partner_count"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                </div>
                            </div>
                            <div class="o_kanban_record_body">
                                <field name="code"/>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <span class="badge badge-pill">
                                        <field name="partner_count"/> partners
                                    </span>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Acción y menú -->
    <record id="action_contact_classification" model="ir.actions.act_window">
        <field name="name">Contact Classifications</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">contact.classification</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first contact classification!
            </p>
            <p>
                Classifications help you organize your contacts by different categories
                like Client, Supplier, Director, etc.
            </p>
        </field>
    </record>

    <!-- Menú -->
    <menuitem id="menu_contact_classification_root"
              name="Contact Classifications"
              parent="contacts.menu_contacts"
              sequence="20"/>

    <menuitem id="menu_contact_classification"
              name="Classifications"
              parent="menu_contact_classification_root"
              action="action_contact_classification"
              sequence="10"/>
</odoo>
